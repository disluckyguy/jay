image: archlinux
sources:
  - https://github.com/mahkoh/jay
tasks:
  - install: |
      sudo pacman -Syu --noconfirm
      sudo pacman -S --noconfirm rustup libinput pango mesa libxkbcommon xorg-xwayland adwaita-icon-theme libxcursor cmake
      rustup toolchain install stable
  - configure: |
      sudo rmmod bochs
      sudo modprobe vgem
      sudo chmod a+rw /dev/dri/*
      sudo rm /dev/dri/renderD*
  - build: |
      cd jay
      cargo build --features it
  - test: |
      cd jay
      export RUST_BACKTRACE=1
      ./target/debug/jay run-tests
